<script>
const GROUP_ID = 35398646;

const membersEl = document.getElementById("live-members");
const onlineEl = document.getElementById("live-online");
const memberListEl = document.getElementById("member-list");

async function loadMemberCount() {
  try {
    const res = await fetch(`https://groups.roblox.com/v1/groups/${GROUP_ID}`);
    const data = await res.json();
    membersEl.textContent = data.memberCount.toLocaleString();
  } catch {
    membersEl.textContent = "Error";
  }
}

async function loadOnlineCount() {
  try {
    const res = await fetch(`https://groups.roblox.com/v1/groups/${GROUP_ID}/?includeMembers=true`);
    const data = await res.json();
    const online = data.members.filter(m => m.isOnline).length;
    onlineEl.textContent = online.toLocaleString();
  } catch {
    onlineEl.textContent = "Error";
  }
}

async function loadMembers() {
  memberListEl.textContent = "Loading…";

  let cursor = "";
  let all = [];

  try {
    while (cursor !== null) {
      const res = await fetch(
        `https://groups.roblox.com/v1/groups/${GROUP_ID}/users?cursor=${cursor}`
      );
      const data = await res.json();

      all.push(...data.data);
      cursor = data.nextPageCursor;
    }

    memberListEl.innerHTML = all
      .map(
        m => `
        <div class="member-item">
          <strong>${m.user.username}</strong> — 
          <span>${m.role.name}</span>
        </div>`
      )
      .join("");

  } catch {
    memberListEl.textContent = "Failed to load members.";
  }
}

loadMemberCount();
loadOnlineCount();
loadMembers();

setInterval(() => {
  loadMemberCount();
  loadOnlineCount();
}, 30000);
</script>
